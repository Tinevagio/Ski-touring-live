name: Update MÃ©tÃ©o Daily
on:
  schedule:
    - cron: '0 6 * * *'
    - cron: '0 14 * * *'
  workflow_dispatch:
permissions:
  contents: write
jobs:
  update-meteo:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT_TOKEN }}  # â† AJOUT ICI
      
      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests pandas
          pip install requests pandas pyarrow
      
      - name: ğŸŒ¤ï¸ Fetch weather data
        run: |
          python scripts/fetch_meteo_auto.py
      
      - name: ğŸ’¾ Commit and push changes
        run: |
          git config user.name "Tinevagio"  # â† MODIFIÃ‰
          git config user.email "giovanetti.matthieu@gmail.com"  # â† MODIFIÃ‰
          git add data/meteo_cache.csv
          git add data/meteo_cache.parquet
          if git diff --staged --quiet; then
            echo "Aucun changement dÃ©tectÃ©."
          else
            git commit -m "chore: mise Ã  jour donnÃ©es mÃ©tÃ©o - $(date -u +'%Y-%m-%d %H:%M UTC')"
            git push
          fi
